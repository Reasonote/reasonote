---------------------------------------------------------------------------
-- 
-- ⚠️ DO NOT EDIT THIS FILE!
-- THIS FILE WAS AUTOMATICALLY GENERATED FROM THE CONTENTS OF A CLEANLY-MIGRATED DATABASE.
-- 
-- ℹ️ To change the contents of this file, create a new migration under 'supabase/migrations/'
-- that makes the change you would like to see.
-- 
---------------------------------------------------------------------------
-- Function: public.get_user_canceled_subscriptions

---------------------------------------------------------------------------
-- BEGIN: PG_DUMP RESULT (FUNCTION: public.get_user_canceled_subscriptions)
------------------------------
CREATE OR REPLACE FUNCTION public.get_user_canceled_subscriptions()
 RETURNS TABLE(stripe_subscription_id text, stripe_product_id text, stripe_product_name text, canceled_at timestamp without time zone, cancellation_reason text)
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$
DECLARE
    customer_id text;
BEGIN
    -- Get the customer ID for the current user
    SELECT public.cur_user_stripe_customer_id() INTO customer_id;
    
    IF customer_id IS NULL THEN
        RETURN;
    END IF;
    
    RETURN QUERY
    SELECT 
        s.id as stripe_subscription_id, 
        s.stripe_product_id, 
        p.name as stripe_product_name,
        s.canceled_at,
        s.cancellation_reason
    FROM public.stripe_subscriptions AS s
    JOIN public.stripe_products AS p ON s.stripe_product_id = p.id
    WHERE s.customer = customer_id AND s.canceled_at IS NOT NULL;
END;
$function$



------------------------------
-- END: PG_DUMP RESULT (FUNCTION: public.get_user_canceled_subscriptions)
---------------------------------------------------------------------------
