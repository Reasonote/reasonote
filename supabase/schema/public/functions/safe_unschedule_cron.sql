---------------------------------------------------------------------------
-- 
-- ⚠️ DO NOT EDIT THIS FILE!
-- THIS FILE WAS AUTOMATICALLY GENERATED FROM THE CONTENTS OF A CLEANLY-MIGRATED DATABASE.
-- 
-- ℹ️ To change the contents of this file, create a new migration under 'supabase/migrations/'
-- that makes the change you would like to see.
-- 
---------------------------------------------------------------------------
-- Function: public.safe_unschedule_cron

---------------------------------------------------------------------------
-- BEGIN: PG_DUMP RESULT (FUNCTION: public.safe_unschedule_cron)
------------------------------
CREATE OR REPLACE FUNCTION public.safe_unschedule_cron(job_name text)
 RETURNS void
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$
BEGIN
    -- Check if user is admin or superuser
    IF NOT (public.is_admin() OR current_user = 'postgres') THEN
        RAISE EXCEPTION 'Only administrators or superusers can unschedule cron jobs';
    END IF;

    IF EXISTS (
        SELECT 1 FROM cron.job 
        WHERE jobname = job_name
    ) THEN
        PERFORM cron.unschedule(job_name);
    END IF;
END;
$function$



------------------------------
-- END: PG_DUMP RESULT (FUNCTION: public.safe_unschedule_cron)
---------------------------------------------------------------------------
