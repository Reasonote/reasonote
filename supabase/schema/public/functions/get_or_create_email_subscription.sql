---------------------------------------------------------------------------
-- 
-- ⚠️ DO NOT EDIT THIS FILE!
-- THIS FILE WAS AUTOMATICALLY GENERATED FROM THE CONTENTS OF A CLEANLY-MIGRATED DATABASE.
-- 
-- ℹ️ To change the contents of this file, create a new migration under 'supabase/migrations/'
-- that makes the change you would like to see.
-- 
---------------------------------------------------------------------------
-- Function: public.get_or_create_email_subscription

---------------------------------------------------------------------------
-- BEGIN: PG_DUMP RESULT (FUNCTION: public.get_or_create_email_subscription)
------------------------------
CREATE OR REPLACE FUNCTION public.get_or_create_email_subscription(p_user_id text)
 RETURNS SETOF email_subscription
 LANGUAGE plpgsql
AS $function$
BEGIN
    -- Try to find existing subscriptions
    RETURN QUERY
        SELECT * FROM email_subscription WHERE user_id = p_user_id;
    
    -- If no rows returned, insert a new row
    IF NOT FOUND THEN
        RETURN QUERY
        INSERT INTO email_subscription (user_id, created_by, updated_by)
        VALUES (p_user_id, p_user_id, p_user_id)
        RETURNING *;
    END IF;
END;
$function$



------------------------------
-- END: PG_DUMP RESULT (FUNCTION: public.get_or_create_email_subscription)
---------------------------------------------------------------------------
