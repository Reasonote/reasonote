---------------------------------------------------------------------------
-- 
-- ⚠️ DO NOT EDIT THIS FILE!
-- THIS FILE WAS AUTOMATICALLY GENERATED FROM THE CONTENTS OF A CLEANLY-MIGRATED DATABASE.
-- 
-- ℹ️ To change the contents of this file, create a new migration under 'supabase/migrations/'
-- that makes the change you would like to see.
-- 
---------------------------------------------------------------------------
-- View: public.vw_course_memauth

---------------------------------------------------------------------------
-- BEGIN: PG_DUMP RESULT (VIEW: public.vw_course_memauth)
------------------------------
--
-- PostgreSQL database dump
--

-- Dumped from database version 15.8
-- Dumped by pg_dump version 15.8

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: vw_course_memauth; Type: VIEW; Schema: public; Owner: postgres
--

CREATE VIEW public.vw_course_memauth AS
 SELECT ma.id AS memauth_id,
    ma.principal_id,
    ma.principal_type,
    ma.resource_entity_id AS course_id,
    ma.access_level,
    array_agg(alp.permission_code ORDER BY alp.permission_code) AS permissions,
    ma.is_public
   FROM ((public.memauth ma
     JOIN public.access_level_permission alp ON ((((alp.entity_type)::text = 'course'::text) AND (upper((alp.access_level)::text) = upper((ma.access_level)::text)))))
     JOIN public.course l ON ((l.id = ma.resource_entity_id)))
  WHERE (ma.resource_entity_type = 'course'::text)
  GROUP BY ma.id, ma.principal_id, ma.principal_type, ma.resource_entity_id, ma.access_level, ma.is_public;


ALTER TABLE public.vw_course_memauth OWNER TO postgres;

--
-- Name: VIEW vw_course_memauth; Type: COMMENT; Schema: public; Owner: postgres
--

COMMENT ON VIEW public.vw_course_memauth IS 'Shows course authorizations, what principals have which access_levels & permissions on which course.';


--
-- Name: TABLE vw_course_memauth; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.vw_course_memauth TO anon;
GRANT ALL ON TABLE public.vw_course_memauth TO authenticated;
GRANT ALL ON TABLE public.vw_course_memauth TO service_role;


--
-- PostgreSQL database dump complete
--


------------------------------
-- END: PG_DUMP RESULT (VIEW: public.vw_course_memauth)
---------------------------------------------------------------------------
